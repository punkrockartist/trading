import sys
import logging

import pandas as pd

sys.path.extend(['..', '.'])
import kis_auth as ka
from domestic_stock_functions_ws import *

# 로깅 설정
logging.basicConfig(level=logging.INFO, format='%(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

# 인증
ka.auth()
ka.auth_ws()
trenv = ka.getTREnv()

# 웹소켓 선언
kws = ka.KISWebSocket(api_url="/tryitout")

##############################################################################################
# [국내주식] 실시간시세 > 국내주식 실시간호가 (KRX) [실시간-004]
##############################################################################################

#kws.subscribe(request=asking_price_krx, data=["005930", "000660"])

##############################################################################################
# [국내주식] 실시간시세 > 국내주식 실시간호가 (NXT)
##############################################################################################

#kws.subscribe(request=asking_price_nxt, data=["005930", "000660"])

##############################################################################################
# [국내주식] 실시간시세 > 국내주식 실시간호가 (통합)
##############################################################################################

#kws.subscribe(request=asking_price_total, data=["005930", "000660"])

##############################################################################################
# [국내주식] 실시간시세 > 국내주식 실시간체결가(KRX) [실시간-003]
##############################################################################################

kws.subscribe(request=ccnl_krx, data=["005930", "000660"])

##############################################################################################
# [국내주식] 실시간시세 > 국내주식 주식체결통보 [실시간-005]
##############################################################################################

#kws.subscribe(request=ccnl_notice, data=[trenv.my_htsid])

##############################################################################################
# [국내주식] 실시간시세 > 국내주식 실시간체결가 (NXT)
##############################################################################################

#kws.subscribe(request=ccnl_nxt, data=["005930", "000660"])

##############################################################################################
# [국내주식] 실시간시세 > 국내주식 실시간체결가 (통합)
##############################################################################################

#kws.subscribe(request=ccnl_total, data=["005930", "000660"])

##############################################################################################
# [국내주식] 실시간시세 > 국내지수 실시간체결 [실시간-026]
##############################################################################################

#kws.subscribe(request=index_ccnl, data=["0001", "0128"])

##############################################################################################
# [국내주식] 실시간시세 > 국내주식 장운영정보 (KRX) [실시간-049]
##############################################################################################

#kws.subscribe(request=market_status_krx, data=["417450", "308100"])

##############################################################################################
# [국내주식] 실시간시세 > 국내주식 장운영정보(NXT)
##############################################################################################

#kws.subscribe(request=market_status_nxt, data=["006220"])

##############################################################################################
# [국내주식] 실시간시세 > 국내주식 장운영정보(통합)
##############################################################################################

#kws.subscribe(request=market_status_total, data=["158430"])

# 시작
def on_result(ws, tr_id, result, data_info):
    print(f"\n[실시간 데이터 수신] TR_ID: {tr_id}")
    print(result)
    print("-" * 80)


print("=" * 80)
print("WebSocket 연결 시작...")
print("종료하려면 Ctrl+C를 누르세요")
print("=" * 80)

try:
    kws.start(on_result=on_result)
except KeyboardInterrupt:
    print("\n\nWebSocket 연결 종료")
except Exception as e:
    print(f"\n오류 발생: {e}")
    import traceback
    traceback.print_exc()